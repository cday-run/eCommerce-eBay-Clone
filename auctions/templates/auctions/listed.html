{% extends "auctions/layout.html" %}

{% block title %}
    {{ title }}
{% endblock %}


{% block body %}

	<h1>{{ title }}</h1>
	<!-- Notify who the auction winner is if it is closed -->
	{% if available == False %}
		<h2>Congratulations {{ winner }} on winning the auction!</h2>
	<!-- Otherwise if auction is still open display the follow -->
	{% else %}
		<!-- display alert message if criteria is met in views -->
	    {% if messages %}
	    	<div class="messages">
	    		{% for message in messages %}
	            <div class="alert alert-warning" role="alert">
	                {{ message }}
	            </div>
	    		{% endfor %}
	    	</div>
	    {% endif %}
	    <!--Display starting price and current highest bif -->
		<div>
			{% for bid in high_bid %}
				<h3>Current Highest Bid: {{ bid.value }}</h3> 
				<h4>By: {{ bid.bidder }}</h4>
			{% empty %}
				<h3 hidden></h3>
			{% endfor %}
			<h4>Starting Price: {{ price }}</h4>
		</div>

		<div>
			{{ description }}
		</div>
		{% if user.is_authenticated %}
			<!-- create button to add item to watchlist -->
			<div>
				<form action="{% url 'add_watch' item_id=listed_id %}" method="post">
					{% csrf_token %}
					<button class="btn btn-primary" type="submit">Add to Watchlist</button>
				</form>
				{% if item.image %}
                	<a href="{{ item.image }}" target="blank">See Image</a> 
            	{% else %}
                	<p>No image</p>
           		{% endif %}
           		<!-- if user is creator create button to allow them to close auction -->
           		{% if seller == username %}
	           		<form action="{% url 'close' item_id=listed_id %}" method="post">
						{% csrf_token %}
						<button class="btn btn primary" type="submit">Close Auction</button>
					</form>
				{% else %}
				<!-- if anyother user create button to allow them to bid -->
					<form action="{% url 'bid' item_id=listed_id %}" method="post">
						{% csrf_token %}
						<input name="new_bid" class="form-group" type="number" step="0.01">
						<button class="btn btn primary" type="submit">Submit Bid</button>
					</form>
				{% endif %}
			</div>
			<div>
				<!-- create a form to allow users to post comments -->
				<form action="{% url 'comment' item_id=listed_id %}" method="post">
					{% csrf_token %}
					<input name="new_comment" type="text" placeholder="Add comment">
					<button class="btn btn-success" type="submit">Comment</button>
				</form>
				<!--Display all comments on current listing -->
				{% for comment in comments %}
					<h3>{{ comment.commenter }}</h3>
					<p>{{ comment.comment }}</p>
				{% empty %}
					<p>No comments on this listing</p>
				{% endfor %}
			</div>
		{% endif %}
	{% endif %}

{% endblock %}